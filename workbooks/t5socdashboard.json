{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
        "type": "string",
        "defaultValue": "<workspacename>"
    },
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "29121SOC Dashboard",
      "metadata": {
        "description": "friendly name."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "gallery"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/<subscriptionId>/resourcegroups/sentinel/providers/microsoft.operationalinsights/workspaces/<workspace>",
      "metadata": {
        "description": "xxx"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "f011bdb6-130b-4769-9a5f-1c80bc340f34",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "# SOC Dashboard (new version)"
          },
          "customWidth": "35",
          "name": "Main headline"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "9a199167-2dde-49dd-8f01-23e9d1fa8151",
                "version": "KqlParameterItem/1.0",
                "name": "InternalWSs",
                "type": 1,
                "isRequired": true,
                "query": "SecurityIncident\r\n| take 1\r\n| parse IncidentUrl with * \"/workspaces/\" Workspace \"/\" *\r\n| project Workspace",
                "isHiddenWhenLocked": true,
                "timeContext": {
                  "durationMs": 604800000
                },
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "value": null
              },
              {
                "id": "7806fefd-432f-4828-9756-8c0be5c08d07",
                "version": "KqlParameterItem/1.0",
                "name": "InternalSub",
                "type": 1,
                "isRequired": true,
                "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
                "crossComponentResources": [
                  "value::selected"
                ],
                "isHiddenWhenLocked": true,
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "55d3ab63-6e1f-4d02-8d9e-2225526689c7",
                "version": "KqlParameterItem/1.0",
                "name": "Subscription",
                "type": 6,
                "isRequired": true,
                "query": "Resources\r\n| summarize Count = count() by subscriptionId\r\n| order by Count desc\r\n| extend Rank = row_number()\r\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1",
                "crossComponentResources": [
                  "value::selected"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "95a45501-31b5-4ea2-bcb3-eb208e0080e2",
                "version": "KqlParameterItem/1.0",
                "name": "Workspace",
                "type": 5,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "//resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains //'SecurityInsights' | project id //= tostring(properties.workspaceResourceId)\r\n\r\nwhere type =~ 'microsoft.operationalinsights/workspaces'\r\n| project value =id, label = name, selected = iff(name =~ '{InternalWSs}', true, false)\r\n\r\n\r\n",
                "crossComponentResources": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": []
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "7d597ad7-4a2a-45ed-a4fe-7ee32de0fc22",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "label": "Incident Creation Time",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 14400000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 172800000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2592000000
                    }
                  ],
                  "allowCustom": true
                }
              },
              {
                "id": "3a87d4f7-42cc-4c62-b543-6b5d9ab8cf27",
                "version": "KqlParameterItem/1.0",
                "name": "Severity",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityIncident\r\n| summarize Count = count(IncidentNumber) by Severity\r\n| project Value = Severity, Label = strcat(Severity, \": \", Count)",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "selectAllValue": "*"
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "81085d3a-5aca-488e-b7c6-ecf1167e59f7",
                "version": "KqlParameterItem/1.0",
                "name": "Tactics",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityIncident\r\n| extend Tactics = todynamic(AdditionalData.tactics)\r\n| mvexpand Tactics to typeof(string)\r\n| summarize Count=count(IncidentNumber) by Tactics\r\n| project Value = Tactics, Label = strcat(Tactics, \": \", Count)",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "selectAllValue": "*"
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "0f9efb0d-ac34-41d0-8a19-165840eb2a71",
                "version": "KqlParameterItem/1.0",
                "name": "Owner",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityIncident\r\n| extend owner = tostring(Owner.assignedTo) \r\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\"\", \"Unassigned\",owner)\r\n| project Value = Owner, Label = strcat(Owner, \": \", Count)",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "selectAllValue": "*"
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "cf86113b-59ad-4fc9-aeb7-9b44e230641e",
                "version": "KqlParameterItem/1.0",
                "name": "Product",
                "label": "Product Name",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityIncident\r\n| extend Product = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0]) \r\n| summarize Count=count(IncidentNumber) by Product\r\n| project Value = Product, Label = strcat(Product, \": \", Count)\r\n",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "selectAllValue": "*"
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "baa92cd2-7ade-41c3-a07c-a11f5ce3e0e6",
                "version": "KqlParameterItem/1.0",
                "name": "Help",
                "label": "Show Help",
                "type": 10,
                "isRequired": true,
                "typeSettings": {
                  "additionalResourceOptions": []
                },
                "jsonData": "[[{ \"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }]",
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange"
              }
            ],
            "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          "customWidth": "100",
          "name": "parameters - 6"
        },
        {
          "type": 1,
          "content": {
            "json": "## Incidents created over time"
          },
          "customWidth": "67",
          "name": "Incidents over time - headline - Copy"
        },
        {
          "type": 1,
          "content": {
            "json": "## Incidents by closing classification"
          },
          "customWidth": "32",
          "name": "Incidents by classification - headline"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident \n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData,CreatedTime) by IncidentNumber\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize count() by bin(CreatedTime, 1h)\n\n\n\n",
            "size": 1,
            "timeContext": {
              "durationMs": 14400000
            },
            "timeContextFromParameter": "TimeRange",
            "timeBrushParameterName": "TimeBrush",
            "exportFieldName": "CreatedTime",
            "exportParameterName": "TimePicker",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "visualization": "unstackedbar",
            "gridSettings": {
              "sortBy": [
                {
                  "itemKey": "CreatedTime",
                  "sortOrder": 2
                }
              ]
            },
            "sortBy": [
              {
                "itemKey": "CreatedTime",
                "sortOrder": 2
              }
            ],
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "count_",
                  "label": "Incidents"
                }
              ]
            }
          },
          "customWidth": "67",
          "name": "Incidents over time "
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident\n| where CreatedTime >= {TimeBrush:start} and CreatedTime <= {TimeBrush:end}\n| where Status == 'Closed'\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| extend feedback =strcat(Classification,\" \",ClassificationReason)\n| summarize dcount(IncidentNumber) by feedback\n",
            "size": 1,
            "timeContext": {
              "durationMs": 14400000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "visualization": "piechart"
          },
          "customWidth": "33",
          "name": "Incidents by classification - headline"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident \n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\n| summarize arg_max(TimeGenerated,Status, Severity, Owner, AdditionalData) by IncidentNumber\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize dcount(IncidentNumber) by Severity",
            "size": 1,
            "title": "Incidents created by severity",
            "timeContext": {
              "durationMs": 14400000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "visualization": "piechart",
            "tileSettings": {
              "showBorder": false,
              "titleContent": {
                "columnMatch": "Classification",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "dcount_IncidentNumber",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "maximumSignificantDigits": 3,
                    "maximumFractionDigits": 2
                  }
                }
              }
            },
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Informational",
                  "color": "gray"
                },
                {
                  "seriesName": "Low",
                  "color": "yellow"
                },
                {
                  "seriesName": "Medium",
                  "color": "orange"
                },
                {
                  "seriesName": "High",
                  "color": "red"
                }
              ]
            }
          },
          "customWidth": "22",
          "name": "By severity"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData) by IncidentNumber\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize count() by case(tostring(Owner)==\"\", \"Unassigned\",tostring(Owner))\n\n",
            "size": 1,
            "title": "Incidents created by owner",
            "timeContext": {
              "durationMs": 14400000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "visualization": "piechart",
            "tileSettings": {
              "showBorder": false,
              "titleContent": {
                "columnMatch": "Classification",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "dcount_IncidentNumber",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "maximumSignificantDigits": 3,
                    "maximumFractionDigits": 2
                  }
                }
              }
            }
          },
          "customWidth": "22",
          "name": "By owner"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData) by IncidentNumber\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize count() by Status\n",
            "size": 1,
            "title": "Incidents created by status",
            "timeContext": {
              "durationMs": 14400000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "visualization": "piechart",
            "tileSettings": {
              "showBorder": false,
              "titleContent": {
                "columnMatch": "Classification",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "dcount_IncidentNumber",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "maximumSignificantDigits": 3,
                    "maximumFractionDigits": 2
                  }
                }
              }
            }
          },
          "customWidth": "22",
          "name": "By status"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "Time to detect, is the time between the incident creation and its first update.",
                  "style": "info"
                },
                "customWidth": "50",
                "conditionalVisibility": {
                  "parameterName": "Help",
                  "comparison": "isEqualTo",
                  "value": "Yes"
                },
                "name": "Help1"
              },
              {
                "type": 1,
                "content": {
                  "json": "Time to closure, is the time between the incident creation and its last closure.",
                  "style": "info"
                },
                "customWidth": "50",
                "conditionalVisibility": {
                  "parameterName": "Help",
                  "comparison": "isEqualTo",
                  "value": "Yes"
                },
                "name": "Help1 - Copy"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "SecurityIncident\n| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \n| extend TimeToDetect =  (FirstModifiedTime - CreatedTime)/1h\n| summarize 50th_Percentile=percentile(TimeToDetect, 50) \n",
                  "size": 2,
                  "title": "Mean time to detect (MTTD)",
                  "timeContext": {
                    "durationMs": 94608000000,
                    "endTime": "2023-06-01T16:58:00.000Z"
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "visualization": "tiles",
                  "tileSettings": {
                    "titleContent": {
                      "formatter": 1
                    },
                    "leftContent": {
                      "columnMatch": "50th_Percentile",
                      "formatter": 12,
                      "formatOptions": {
                        "palette": "auto"
                      },
                      "numberFormat": {
                        "unit": 26,
                        "options": {
                          "style": "decimal",
                          "useGrouping": false,
                          "maximumFractionDigits": 3
                        }
                      }
                    },
                    "showBorder": false,
                    "size": "auto"
                  }
                },
                "customWidth": "50",
                "name": "MTTD"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "SecurityIncident\n| where ClosedTime >= {TimeRange:start} and ClosedTime <= {TimeRange:end}\n| where Severity in ({Severity}) or \"*\" in ({Severity})\n| extend Tactics = todynamic(AdditionalData.tactics)\n| where Tactics in ({Tactics}) or \"*\" in ({Tactics})\n| extend Owner = todynamic(Owner.assignedTo) \n| where Owner in ({Owner}) or \"*\" in ({Owner})\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| where Product in ({Product}) or \"*\" in ({Product})\n| summarize arg_max(TimeGenerated,*) by IncidentNumber \n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\n| summarize 50th_Percentile=percentile(TimeToClosure, 50)",
                  "size": 2,
                  "title": "Mean time to resolve (MTTR) ",
                  "timeContext": {
                    "durationMs": 94608000000,
                    "endTime": "2023-06-01T16:33:00.000Z"
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "visualization": "tiles",
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Classification",
                      "formatter": 1,
                      "formatOptions": {}
                    },
                    "leftContent": {
                      "columnMatch": "50th_Percentile",
                      "formatter": 12,
                      "formatOptions": {
                        "palette": "auto"
                      },
                      "numberFormat": {
                        "unit": 26,
                        "options": {
                          "style": "decimal",
                          "useGrouping": false,
                          "maximumFractionDigits": 3
                        }
                      }
                    },
                    "showBorder": false,
                    "size": "auto"
                  }
                },
                "customWidth": "50",
                "name": "MTTM"
              }
            ]
          },
          "customWidth": "34",
          "name": "Mean times"
        },
        {
          "type": 1,
          "content": {
            "json": "## Alerts created over time"
          },
          "customWidth": "67",
          "name": "Alerts over time - headline"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "08f97f34-6264-4fa3-90b5-16b89422d285",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 7776000000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 300000
                    },
                    {
                      "durationMs": 900000
                    },
                    {
                      "durationMs": 1800000
                    },
                    {
                      "durationMs": 3600000
                    },
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 172800000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2419200000
                    },
                    {
                      "durationMs": 2592000000
                    },
                    {
                      "durationMs": 5184000000
                    },
                    {
                      "durationMs": 7776000000
                    }
                  ]
                }
              },
              {
                "id": "cd98a9c7-5dbd-4f92-a967-7ed1c781132a",
                "version": "KqlParameterItem/1.0",
                "name": "AlertSeverity",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityAlert\r\n| summarize Count = count() by AlertSeverity\r\n| order by Count desc, AlertSeverity asc\r\n| project Value = AlertSeverity, Label = strcat(AlertSeverity, ' - ', Count)",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ]
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              {
                "id": "df0fbc31-ade1-4488-9109-a4f647ad8fe2",
                "version": "KqlParameterItem/1.0",
                "name": "ProductName",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "SecurityAlert\r\n| summarize Count = count() by ProductName\r\n| order by Count desc, ProductName asc\r\n| project Value = ProductName, Label = strcat(ProductName, ' - ', Count)",
                "value": null,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ]
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "parameters - 3"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "let data = SecurityAlert\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName});\ndata\n| summarize Count = count() by AlertSeverity\n| join kind = inner (data\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by AlertSeverity)\n on AlertSeverity\n | project-away TimeGenerated\n| extend AlertSeveritys = AlertSeverity\n| union (\n data \n | summarize Count = count() \n | extend jkey = 1\n | join kind=inner (data\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\n | extend jkey = 1) on jkey\n | extend AlertSeverity = 'All', AlertSeveritys = '*' \n)\n| extend Severity = iif(AlertSeverity == \"All\", 0,iif(AlertSeverity == \"High\", 1, iif(AlertSeverity == \"Medium\", 2, iif(AlertSeverity == \"Low\", 3, 4))))\n| order by Severity asc\n",
            "size": 3,
            "title": "Security Alerts by Severity",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "exportFieldName": "AlertSeverity",
            "exportParameterName": "AlertSeverityPicker",
            "exportDefaultValue": "All",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "tiles",
            "tileSettings": {
              "titleContent": {
                "columnMatch": "AlertSeverity",
                "formatter": 1,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "leftContent": {
                "columnMatch": "Count",
                "formatter": 12,
                "formatOptions": {
                  "showIcon": true
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "style": "decimal",
                    "maximumFractionDigits": 2,
                    "maximumSignificantDigits": 3
                  }
                }
              },
              "secondaryContent": {
                "columnMatch": "Trend",
                "formatter": 9,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "showBorder": false,
              "sortOrderField": 1
            }
          },
          "name": "SecurityAlertsbySeverity"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "let data = SecurityAlert\r\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\r\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName})\r\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \"All\";\r\ndata\r\n| summarize Count = count() by ProductName\r\n| join kind = inner (data\r\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ProductName)\r\n on ProductName\r\n | project-away TimeGenerated\r\n| extend ProductNames = ProductName\r\n| union (\r\n data \r\n | summarize Count = count() \r\n | extend jkey = 1\r\n | join kind=inner (data\r\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n | extend jkey = 1) on jkey\r\n | extend ProductName = 'All', ProductNames = '*' \r\n)\r\n| order by Count desc\r\n",
            "size": 3,
            "title": "Security Alerts by Product",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "exportFieldName": "ProductName",
            "exportParameterName": "ProductNamePicker",
            "exportDefaultValue": "All",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "tiles",
            "tileSettings": {
              "titleContent": {
                "columnMatch": "ProductName",
                "formatter": 1,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "leftContent": {
                "columnMatch": "Count",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto",
                  "showIcon": true
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "maximumSignificantDigits": 3,
                    "maximumFractionDigits": 2
                  }
                }
              },
              "secondaryContent": {
                "columnMatch": "Trend",
                "formatter": 9,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "showBorder": false
            }
          },
          "name": "SecurityAlertsbyProduct"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityAlert\r\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\r\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName})\r\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \"All\"\r\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \"All\"\r\n| summarize count() by AlertSeverity, bin(TimeGenerated, 1d)",
            "size": 0,
            "title": "Security Alerts Over Time by Severity",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "linechart",
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Medium",
                  "color": "orange"
                },
                {
                  "seriesName": "Low",
                  "color": "yellow"
                },
                {
                  "seriesName": "Informational",
                  "color": "gray"
                },
                {
                  "seriesName": "High",
                  "color": "red"
                }
              ]
            }
          },
          "name": "SecurityAlertsOverTimebySeverity"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityAlert\r\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\r\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName})\r\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \"All\"\r\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \"All\"\r\n| summarize count() by ProductName, bin(TimeGenerated, 1d)",
            "size": 0,
            "title": "Security Alerts Over Time by Product",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "unstackedbar",
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Medium",
                  "color": "orange"
                },
                {
                  "seriesName": "Low",
                  "color": "yellow"
                },
                {
                  "seriesName": "Informational",
                  "color": "gray"
                },
                {
                  "seriesName": "High",
                  "color": "red"
                }
              ]
            }
          },
          "name": "SecurityAlertsOverTimebyProduct"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityAlert\r\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\r\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName})\r\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \"All\"\r\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \"All\"\r\n| extend Entities = iff(isempty(Entities), todynamic('[{\"dummy\" : \"\"}]'), todynamic(Entities))\r\n| mvexpand Entities\r\n| evaluate bag_unpack(Entities, \"Entity_\")\r\n| extend Entity_Type = columnifexists(\"Entity_Type\", \"\")\r\n| extend Entity_Name = columnifexists(\"Entity_Name\", \"\")\r\n| extend Entity_ResourceId = columnifexists(\"Entity_ResourceId\", \"\")\r\n| extend Entity_Directory = columnifexists(\"Entity_Directory\", \"\")\r\n| extend Entity_Value = columnifexists(\"Entity_Value\", \"\")\r\n| extend Entity_HostName = columnifexists(\"Entity_HostName\", \"\")\r\n| extend Entity_Address = columnifexists(\"Entity_Address\", \"\")\r\n| extend Entity_ProcessId = columnifexists(\"Entity_ProcessId\", \"\")\r\n| extend Entity_Url = columnifexists(\"Entity_Url\", \"\")\r\n| extend Target = iif(Entity_Type == \"account\", Entity_Name, iif(Entity_Type == \"azure-resource\", Entity_ResourceId, iif(Entity_Type == \"cloud-application\", Entity_Name, iif(Entity_Type == \"dns\", Entity_Name, iif(Entity_Type == \"file\", strcat(Entity_Directory, \"\\\\\", Entity_Name), iif(Entity_Type == \"filehash\", Entity_Value, iif(Entity_Type == \"host\", Entity_HostName, iif(Entity_Type == \"ip\" , Entity_Address, iif(Entity_Type == \"malware\", Entity_HostName, iif(Entity_Type == \"network-connection\", Entity_Name, iif(Entity_Type == \"process\", Entity_ProcessId, iif(Entity_Type == \"registry-key\", Entity_Name, iif(Entity_Type == \"registry-value\", Entity_Name, iif(Entity_Type == \"security-group\", Entity_Name, iif(Entity_Type == \"url\", Entity_Url, \"NoTarget\")))))))))))))))\r\n| where Entity_Type in (\"account\", \"host\", \"ip\", \"url\", \"azure-resource\", \"cloud-application\", \"dns\", \"file\", \"filehash\", \"malware\", \"network-connection\", \"process\", \"registry-key\", \"registry-value\", \"security-group\")\r\n| summarize count() by bin(TimeGenerated, 1d), Target, Entity_Type\r\n| project-away TimeGenerated\r\n| order by count_ desc\r\n\r\n",
            "size": 0,
            "title": "Top Entities in Security Alerts",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "TopEntitiesinSecurityAlerts"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityAlert\r\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\r\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName})\r\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \"All\"\r\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \"All\"\r\n| extend Entities = iff(isempty(Entities), todynamic('[{\"dummy\" : \"\"}]'), todynamic(Entities))\r\n| mvexpand Entities\r\n| evaluate bag_unpack(Entities, \"Entity_\")\r\n| extend Entity_Type = columnifexists(\"Entity_Type\", \"\")\r\n| where Entity_Type in (\"account\", \"alerts\", \"azure-resource\", \"cloud-application\", \"dns\", \"file\", \"filehash\", \"host\", \"host-logon-session\", \"ip\", \"malware\", \"network-connection\", \"process\", \"registry-key\", \"registry-value\", \"security-group\", \"SrvSvcSessionEntry\", \"url\")\r\n| summarize count() by Entity_Type\r\n| order by count_ desc",
            "size": 0,
            "title": "Count of Entities in Security Alerts by Type",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "unstackedbar"
          },
          "name": "CountofEntitiesinSecurityAlertsbyType"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "let data = SecurityAlert\n| where \"{AlertSeverity:lable}\" == \"All\" or AlertSeverity in ({AlertSeverity})\n| where \"{ProductName:lable}\" == \"All\" or ProductName in ({ProductName});\ndata\n| summarize Count = count() by AlertSeverity\n| join kind = inner (data\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by AlertSeverity)\n on AlertSeverity\n | project-away TimeGenerated\n| extend AlertSeveritys = AlertSeverity\n| union (\n data \n | summarize Count = count() \n | extend jkey = 1\n | join kind=inner (data\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\n | extend jkey = 1) on jkey\n | extend AlertSeverity = 'All', AlertSeveritys = '*' \n)\n| extend Severity = iif(AlertSeverity == \"All\", 0,iif(AlertSeverity == \"High\", 1, iif(AlertSeverity == \"Medium\", 2, iif(AlertSeverity == \"Low\", 3, 4))))\n| order by Severity asc\n",
            "size": 3,
            "title": "Security Alerts by Severity",
            "timeContext": {
              "durationMs": 7776000000
            },
            "timeContextFromParameter": "TimeRange",
            "exportFieldName": "AlertSeverity",
            "exportParameterName": "AlertSeverityPicker",
            "exportDefaultValue": "All",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "piechart",
            "tileSettings": {
              "titleContent": {
                "columnMatch": "AlertSeverity",
                "formatter": 1,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "leftContent": {
                "columnMatch": "Count",
                "formatter": 12,
                "formatOptions": {
                  "showIcon": true
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "style": "decimal",
                    "maximumFractionDigits": 2,
                    "maximumSignificantDigits": 3
                  }
                }
              },
              "secondaryContent": {
                "columnMatch": "Trend",
                "formatter": 9,
                "formatOptions": {
                  "showIcon": true
                }
              },
              "showBorder": false,
              "sortOrderField": 1
            }
          },
          "name": "SecurityAlertsbySeverity"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Data Connector",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "8cedb6a0-2ad0-4ec7-b925-56c2aa0c62a3",
                      "version": "KqlParameterItem/1.0",
                      "name": "Select_Workspace",
                      "type": 5,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                      "crossComponentResources": [
                        "value::all"
                      ],
                      "value": [],
                      "typeSettings": {
                        "resourceTypeFilter": {
                          "microsoft.operationalinsights/workspaces": true
                        },
                        "additionalResourceOptions": []
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    }
                  ],
                  "style": "pills",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "parameters - 0",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "union withsource= ['Table Name'] * \r\n| summarize LastEvent = max(TimeGenerated) by ['Table Name']\r\n| extend State = iff(LastEvent < ago(2h), 'Not-Connected', 'Connected')\r\n| extend TimeFromNow = now() - LastEvent\r\n| summarize count () by State\r\n",
                  "size": 3,
                  "title": "Data Connector Status",
                  "timeContext": {
                    "durationMs": 7776000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Select_Workspace}"
                  ],
                  "visualization": "piechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Connected",
                              "representation": "success",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Not-Connected",
                              "representation": "stopped",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Data_Connector",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "tileSettings": {
                    "showBorder": false
                  },
                  "graphSettings": {
                    "type": 0
                  },
                  "chartSettings": {
                    "seriesLabelSettings": [
                      {
                        "seriesName": "Connected",
                        "color": "green"
                      },
                      {
                        "seriesName": "Not-Connected",
                        "color": "red"
                      }
                    ],
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 0,
                        "options": {
                          "style": "decimal",
                          "useGrouping": true
                        }
                      }
                    }
                  },
                  "textSettings": {
                    "style": "bignumber"
                  }
                },
                "customWidth": "25",
                "name": "query - 1 - Copy",
                "styleSettings": {
                  "margin": "25",
                  "padding": "25",
                  "maxWidth": "25",
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "union withsource=_TableName1 *\r\n| summarize count () by ['Table Name']=Type\r\n| summarize sum(count_)",
                  "size": 3,
                  "title": "Log Ingested Count",
                  "timeContext": {
                    "durationMs": 7776000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showRefreshButton": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Select_Workspace}"
                  ],
                  "visualization": "card",
                  "tileSettings": {
                    "showBorder": false
                  },
                  "graphSettings": {
                    "type": 0
                  },
                  "textSettings": {
                    "style": "bignumber"
                  }
                },
                "customWidth": "20",
                "name": "query - 7",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "union withsource=_TableName *\r\n//| where _TimeReceived > ago(1d)\r\n| summarize count(), Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n    ['Average Events per Second (eps)'] = avg(counttemp), ['Minimum eps']=min (counttemp),\r\n    ['Maximum eps']=max(counttemp)\r\n    by ['Table Name']=Type\r\n| order by ['Average Events per Second (eps)'] desc| summarize sum(['Maximum eps'])\r\n",
                  "size": 3,
                  "title": "Maximum EPS Count",
                  "timeContext": {
                    "durationMs": 7776000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showRefreshButton": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Select_Workspace}"
                  ],
                  "visualization": "card",
                  "textSettings": {
                    "style": "bignumber"
                  }
                },
                "customWidth": "15",
                "name": "query - 6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "union withsource=_TableName *\r\n//| where _TimeReceived > ago(1d)\r\n| summarize count(), Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n    ['Average Events per Second (eps)'] = avg(counttemp), ['Minimum eps']=min (counttemp),\r\n    ['Maximum eps']=max(counttemp)\r\n    by ['Table Name']=Type\r\n| order by ['Average Events per Second (eps)'] desc\r\n| summarize sum(['Minimum eps'])\r\n",
                  "size": 3,
                  "title": "Minimum  EPS Count",
                  "timeContext": {
                    "durationMs": 7776000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showRefreshButton": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Select_Workspace}"
                  ],
                  "visualization": "card",
                  "textSettings": {
                    "style": "bignumber"
                  }
                },
                "customWidth": "15",
                "name": "query - 4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "union withsource=_TableName *\r\n//| where _TimeReceived > ago(1d)\r\n| summarize count(), Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n    ['Average Events per Second (eps)'] = avg(counttemp), ['Minimum eps']=min (counttemp),\r\n    ['Maximum eps']=max(counttemp)\r\n    by ['Table Name']=Type\r\n| order by ['Average Events per Second (eps)'] desc\r\n| summarize sum(['Average Events per Second (eps)'])\r\n",
                  "size": 3,
                  "title": "Average EPS Count",
                  "timeContext": {
                    "durationMs": 7776000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showRefreshButton": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Select_Workspace}"
                  ],
                  "visualization": "card",
                  "textSettings": {
                    "style": "bignumber"
                  }
                },
                "customWidth": "25",
                "name": "query - 4",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "name": "Data Connector Status"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "union withsource= ['Table Name'] * \r\n//| distinct  ['Table Name']\r\n| extend Type_01 = case(OfficeWorkload has \"SharePoint\",\"Office(SharePoint)\",\r\n OfficeWorkload has \"Exchange\", \"Office(Exchange)\", OfficeWorkload has \"OneDrive\", \"Office(OneDrive)\", OfficeWorkload has \"MicrosoftTeams\", \"Office(MicrosoftTeams)\", \"\")\r\n//| extend Type_02 = case(OfficeWorkload has \"Azure Advanced Threat Protection\",\"Azure Advanced Threat Protection\", OfficeWorkload has \"MDATP\", \"Microsoft Defender for Endpoint\", OfficeWorkload has \"OATP\", \"Microsoft Defender for Office 365 (Preview)\", OfficeWorkload has \"MCAS\", \"Microsoft Defender for Cloud Apps\", \"\")\r\n| extend Data_Connector = case(\r\nType has \"AuditLogs\", \"Azure Active Directory(Audit_logs)\",\r\nType has \"SigninLogs\", \"Azure Active Directory(Sign_in)\",\r\nType has \"AzureActivity\",\"Azure Activity\",\r\nType has \"SecurityEvents\", \"Security Events via Legacy Agent\",\r\nType has \"Syslog\", \"syslog\",\r\nType has \"DeviceRegistryEvents\",\"Microsoft_365_defender(DeviceRegistryEvents)\",\r\nType has \"DeviceProcessEvents\",\"Microsoft_365_defender(DeviceProcessEvents)\",\r\nType has \"DeviceNetworkInfo\",\"Microsoft_365_defender(DeviceNetworkInfo)\",\r\nType has \"DeviceNetworkEvents\",\"Microsoft_365_defender(DeviceNetworkEvents)\",\r\nType has \"DeviceLogonEvents\",\"Microsoft_365_defender(DeviceLogonEvents)\",\r\nType has \"DeviceInfo\",\"Microsoft_365_defender(DeviceInfo)\",\r\nType has \"DeviceImageLoadEvents\",\"Microsoft_365_defender(DeviceImageLoadEvents)\",\r\nType has \"DeviceFileEvents\",\"Microsoft_365_defender(DeviceFileEvents)\",\r\nType has \"DeviceEvents\",\"Microsoft_365_defender(DeviceEvents)\",\r\nType_01 has \"Office(SharePoint)\", \"Office_365(SharePoint)\",\r\nType_01 has \"Office(Exchange)\", \"Office_365(Exchange)\",\r\nType_01 has \"Office(OneDrive)\", \"Office_365(OneDrive)\",\r\nType_01 has \"Office(MicrosoftTeams)\", \"Office_365(MicrosoftTeams)\",\r\nType has \"SecurtyAlert(ASC)\", \"Microsoft Defencer for Cloud\",\r\n \"empty\")\r\n| where Data_Connector !contains (\"empty\")\r\n| summarize LastEvent = max(TimeGenerated) by Data_Connector\r\n| extend State = iff(LastEvent < ago(12h), 'Not-Connected', 'Connected')\r\n| extend TimeFromNow = now() - LastEvent\r\n| summarize count () by State, Data_Connector",
            "size": 0,
            "showAnalytics": true,
            "title": "Devices Reporting to Sentinel",
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "piechart",
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Connected",
                  "color": "green"
                },
                {
                  "seriesName": "Not-Connected",
                  "color": "redBright"
                }
              ]
            }
          },
          "customWidth": "25",
          "name": "Devices Connected to Sentinel",
          "styleSettings": {
            "margin": "15",
            "padding": "15",
            "maxWidth": "25"
          }
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityIncident\r\n//| where CreatedTime between (datetime(2021-12-11 00:00:00) .. datetime(2021-12-13 23:59:59))\r\n| where Status contains \"Closed\"\r\n| extend FMT = iff(isnotempty(FirstModifiedTime),FirstModifiedTime,CreatedTime)\r\n| summarize Created_Time = min(CreatedTime), FirstModificationTime = min(FirstModifiedTime) by IncidentNumber,Title\r\n| extend FirstModifiedTime = iff(isnotempty(FirstModificationTime),FirstModificationTime,Created_Time)\r\n| extend MTTD = FirstModificationTime-Created_Time\r\n| extend MTTD = datetime_diff(\"minute\",FirstModificationTime,Created_Time)\r\n| extend CreatedDay = datetime_part(\"Day\", Created_Time)\r\n| extend CreatedMonth = datetime_part(\"Month\", Created_Time)\r\n| extend CreatedYear = datetime_part(\"Year\", Created_Time)\r\n| extend CreatedDate = strcat(CreatedDay,\"/\",CreatedMonth,\"/\",CreatedYear)\r\n| project Created_Time,FirstModifiedTime,MTTD, CreatedDate\r\n| order by Created_Time, MTTD desc",
            "size": 0,
            "title": "Data Connector Health Status",
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Connected",
                  "color": "green"
                },
                {
                  "seriesName": "Not-Connected",
                  "color": "redBright"
                }
              ]
            }
          },
          "customWidth": "30",
          "name": "query - 3",
          "styleSettings": {
            "margin": "15",
            "padding": "15",
            "maxWidth": "30"
          }
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "Heartbeat\r\n| where TimeGenerated > ago(1d)\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer, OSType, ComputerEnvironment\r\n| extend State = iff(LastHeartbeat < ago(1h), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat('🕒 ',(strcat(case(TimeFromNow < 1m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 1h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 1d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')))\r\n| project [\"Computer\"]=strcat('🖥️ ', Computer),OSType, State,ComputerEnvironment,TimeAgo,TimeFromNow,LastHeartbeat\r\n| summarize count() by State, OSType",
            "size": 0,
            "title": "Device Reporting to Sentinel By Type",
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "piechart"
          },
          "customWidth": "25",
          "name": "query - 3",
          "styleSettings": {
            "margin": "15",
            "padding": "15",
            "maxWidth": "25",
            "showBorder": true
          }
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "Heartbeat\r\n| where TimeGenerated > ago(1d)\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer, OSType, ComputerEnvironment\r\n| extend State = iff(LastHeartbeat < ago(1h), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat('🕒 ',(strcat(case(TimeFromNow < 1m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 1h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 1d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')))\r\n| project [\"Computer\"]=strcat('🖥️ ', Computer),OSType, State,ComputerEnvironment,TimeAgo,TimeFromNow,LastHeartbeat\r\n| summarize count() by State, OSType",
            "size": 0,
            "title": "Count of Device by Type",
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "customWidth": "20",
          "name": "query - 4",
          "styleSettings": {
            "margin": "10",
            "padding": "10",
            "maxWidth": "20",
            "showBorder": true
          }
        },
        {
          "type": 1,
          "content": {
            "json": "## Logs ingested"
          },
          "name": "text - 2"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "union withsource=_TableName *\n| summarize Count=count() by _TableName\n| render barchart",
            "size": 1,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "query - 2"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "/subscriptions/<subscriptionId>/resourcegroups/sentinel/providers/microsoft.operationalinsights/workspaces/<workspace>"
      ]
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "etag": "*",
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
